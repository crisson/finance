// Open Source Initiative OSI - The MIT License (MIT):Licensing
// 
// The MIT License (MIT)
// Copyright (c) 2012 Crisson Jno-Charles & Alisa Boguslavskaya
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is 
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// from https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/reduce
Array.prototype.reduce||(Array.prototype.reduce=function a(a){if(this===null||this===undefined)throw new TypeError("Object is null or undefined");var b=0,c=this.length>>0,d;if(typeof a!="function")throw new TypeError("First argument is not callable");if(arguments.length<2){if(c===0)throw new TypeError("Array length is 0 and no second argument");d=this[0],b=1}else d=arguments[1];while(b<c)b in this&&(d=a.call(undefined,d,this[b],b,this)),++b;return d}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(this==null)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if({}.toString.call(a)!="[object Function]")throw new TypeError(a+" is not a function");b&&(c=b),d=new Array(g),e=0;while(e<g){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d});var Finance=function(a){function d(a){this.name="DependencyError",this.message=a||"A required dependency was not found"}var b=a||{},c={};return d.prototype=new Error,d.prototype.constructor=d,c.cdf_discrete=function(a,b,c){if(!Array.prototype.reduce)throw console.log("I need to reduce!"),new d("This library requires Array.reduce to be defined");if(!Array.prototype.map)throw console.log("I need a map!"),new d("This library requires Array.map to be defined");if(a instanceof Array){if(b instanceof Array){if(a.length!==b.length)throw new RangeError("the errors must be the same length");var e=a.map(function(a,c,d){var e={};return e[c]=b.reduce(function(a,b,d){return d>c?a:a+b},0),e});return c&&!c.pair?e.map(function(a,b){return a[b]}):e}throw new TypeError("fx must be an array")}throw new TypeError("x must be an array")},c.stdnormal=function(a,b){function e(a){return 1/(Math.sqrt(c)*Math.sqrt(2*Math.PI))*Math.pow(Math.E,-Math.pow(a-d,2)/2*c)}if(typeof a!="number"&&!(a instanceof Array)){if(!a.range)throw new Error("this is an object, so you must specify the number of points in the domain");if(a.range&&a.range<=0)throw new Error("the number of data points must be greater than zero")}b=b||{};var c=b.rho_sqr=b.rho_sqr||1,d=b.mu=b.mu||0;if(a instanceof Array)return a.map(function(a,b){return[b,e(a)]});if(a.range){var f=[];for(var g=0;g<a.range;g++)f.push([g,e(g)]);return f}return e(a)},b.inputs=c,b}(Finance),Finance=function(a){function d(a,b){var c=[];return _.map(b,function(a,b){c.push({ind:a})}),b.reduce(function(b,c,d,e){if(d===0)return b+c;var f=c*Math.pow(1+a,-d);return b+f},0)}function e(a,b){var c=b.reduce(function(b,c,d){return d===0?b:b+ -d*c*Math.pow(1+a,-d-1)},0);return c}var b=a||{},c=12;return b.irr=function f(a,b){var c=a,f=1e3,g=0,h=1e3,i=.01;while(i>1e-6&&g<f){var j=d(c,b),k=e(c,b),l=c;c-=j/k,i=Math.abs(c-l),g++}return g<f?c:Infinity},b.pmt=function(a,b,d){var e=a,f=b,g=d?c*d:c*30;return e=e<0?Math.abs(e):e,e*f*Math.pow(1+f,g)/(Math.pow(1+f,g)-1)},b.amort=function(a,d,e,f){function j(a,b){var e=-a*b/c,f=i-e,h=a+f;return g>0?(g--,j(h,d)):h}f=f||{};var g=c*e,h=_.range(g),i=b.pmt(a,d/c,f.mortgage_term);return g--,j(a,d)},b.amort_with_dp=function(a,b,c,d){},b.blackscholes=function(a,c,d,e,f){if(!b.inputs.cdf)throw new DependencyError("This function requires the continuous distribution function fin.input.cdf to operate");console.log(Math.log(a/c));var g=(Math.log(a/c)+(d+Math.pow(e,2)/2)*f)/(e*Math.sqrt(f));console.log(g);var h=b.inputs.stdnormal(g);console.log(h);var i=b.inputs.cdf([0],[h]);console.log(i)},b}(Finance)